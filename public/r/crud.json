{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "crud",
  "type": "registry:component",
  "title": "CRUD",
  "description": "A component that displays a CRUD interface for a given resource",
  "dependencies": [
    "@tanstack/react-table"
  ],
  "registryDependencies": [
    "dialog",
    "drawer",
    "@vinkas/drawer-dialog"
  ],
  "files": [
    {
      "path": "registry/new-york/blocks/crud/index.tsx",
      "content": "import React, { createContext, Dispatch, FormEvent, ReactNode, SetStateAction, useContext, useState } from \"react\"\nimport CrudTable from \"./table\"\nimport { DrawerDialog, DrawerDialogContent, DrawerDialogContentWrapper, DrawerDialogFooter, DrawerDialogHeader, DrawerDialogTitle } from \"@/registry/new-york/blocks/drawer-dialog/drawer-dialog\"\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/registry/new-york/ui/alert-dialog\"\nimport { Button } from \"@/registry/new-york/ui/button\"\nimport CrudForm from \"./form\"\nimport { Plus } from \"lucide-react\"\nimport { ColumnDef } from \"@tanstack/react-table\"\n\ntype CrudType = {\n  name: string\n  setDialogOpen: (v: boolean) => void\n}\n\nconst CrudContext = createContext<CrudType | undefined>(undefined)\n\nexport function useCrud() {\n  const ctx = useContext(CrudContext)\n  if (!ctx) throw new Error(\"useCrud must be used within <Crud>\")\n  return ctx\n}\n\nexport type CrudFormType<TData> = {\n  method: 'create' | 'update'\n  data: TData\n}\n\nexport type CrudProps<TData, TValue> = {\n  name: string\n  children: ReactNode\n  onCreate: (data: TData, e: FormEvent<HTMLFormElement>) => void\n  onEdit: (data: TData, e: FormEvent<HTMLFormElement>) => void\n  onDelete: (data: TData) => void\n  columns: ColumnDef<TData, TValue>[]\n  data: TData[]\n  formState: [CrudFormType<TData>, Dispatch<SetStateAction<CrudFormType<TData>>>]\n  defaultData?: TData\n}\n\nexport function Crud<TData, TValue>({ name, formState, children, columns, data, onCreate, onEdit, onDelete, defaultData = {} as TData }: CrudProps<TData, TValue>) {\n  const [dialogOpen, setDialogOpen] = useState(false)\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false)\n  const [deleteRow, setDeleteRow] = useState<TData | null>(null)\n  const [formType, setFormType] = formState\n  const [submitting, setSubmitting] = useState(false)\n\n  const onCrudCreate = () => {\n    setDialogOpen(true)\n    setFormType({ method: 'create', data: defaultData })\n  }\n  const onCrudEdit = (data: TData) => {\n    setDialogOpen(true)\n    setFormType({ method: 'update', data })\n  }\n  const onCrudDelete = (data: TData) => {\n    setDeleteRow(data)\n    setDeleteDialogOpen(true)\n  }\n  const Form = React.Children.toArray(children).find((child) => {\n    if (React.isValidElement(child) && child.type === CrudForm) {\n      return child\n    }\n  })\n  const Content = React.Children.toArray(children).filter((child) => {\n    if (React.isValidElement(child) && child.type !== CrudForm) {\n      return child\n    }\n  })\n  const handleSubmit = (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault()\n    setSubmitting(true)\n    setTimeout(() => {\n      if (formType.method === 'update') {\n        onEdit(formType.data, e)\n      } else {\n        onCreate(formType.data, e)\n      }\n      setSubmitting(false)\n      setDialogOpen(false)\n    }, 1000)\n  }\n  return (\n    <CrudContext.Provider value={{ name, setDialogOpen }}>\n      <div className=\"flex flex-col gap-2\">\n        <div className=\"flex justify-end\">\n          <Button size=\"sm\" onClick={onCrudCreate}>\n            <Plus />\n            Add {name}\n          </Button>\n        </div>\n        <CrudTable columns={columns} data={data} onEdit={onCrudEdit} onDelete={onCrudDelete} />\n        {Content}\n      </div>\n      <DrawerDialog open={dialogOpen} onOpenChange={setDialogOpen}>\n        <DrawerDialogContent>\n          <form onSubmit={handleSubmit}>\n            <DrawerDialogHeader>\n              <DrawerDialogTitle>{formType.method === 'update' ? \"Edit\" : \"Add\"} {name}</DrawerDialogTitle>\n            </DrawerDialogHeader>\n            <DrawerDialogContentWrapper>\n              <div className=\"grid gap-4 py-4\">\n                {Form}\n              </div>\n            </DrawerDialogContentWrapper>\n            <DrawerDialogFooter>\n              <Button type=\"submit\" disabled={submitting}>\n                {submitting ? 'Saving...' : 'Save changes'}\n              </Button>\n            </DrawerDialogFooter>\n          </form>\n        </DrawerDialogContent>\n      </DrawerDialog>\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This action cannot be undone. This will permanently delete the {name.toLowerCase()} record.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deleteRow && onDelete?.(deleteRow)}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </CrudContext.Provider >\n  )\n}\n\nexport { CrudTable, CrudForm }",
      "type": "registry:block",
      "target": "components/ui/crud/index.tsx"
    },
    {
      "path": "registry/new-york/blocks/crud/table.tsx",
      "content": "\"use client\"\n\nimport {\n  ColumnDef,\n  flexRender,\n  getCoreRowModel,\n  useReactTable,\n  getPaginationRowModel,\n} from \"@tanstack/react-table\"\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/registry/new-york/ui/table\"\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuGroup, DropdownMenuItem, DropdownMenuLabel, DropdownMenuTrigger } from \"@/registry/new-york/ui/dropdown-menu\";\nimport { Button } from \"@/registry/new-york/ui/button\"\nimport { MoreHorizontal } from \"lucide-react\";\n\nexport type CrudTableProps<TData, TValue> = {\n  columns: ColumnDef<TData, TValue>[]\n  data: TData[]\n  nextPageToken?: string\n  onLoadMore?: (token?: string) => void\n  onEdit?: (row: TData) => void\n  onDelete?: (row: TData) => void\n}\n\nexport default function CrudTable<TData, TValue>({\n  columns,\n  data,\n  nextPageToken,\n  onLoadMore,\n  onEdit,\n  onDelete,\n}: CrudTableProps<TData, TValue>) {\n  const actionColumnIndex = columns.findIndex((column) => column.id === \"actions\")\n  if (actionColumnIndex === -1) {\n    columns.push({\n      id: \"actions\",\n      cell: ({ row }) => (\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" className=\"h-8 w-8 p-0\">\n              <span className=\"sr-only\">Open menu</span>\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuGroup>\n              <DropdownMenuLabel>Actions</DropdownMenuLabel>\n              {onEdit && <DropdownMenuItem onClick={() => onEdit(row.original)}>Edit</DropdownMenuItem>}\n              {onDelete && <DropdownMenuItem variant=\"destructive\" onClick={() => onDelete(row.original)}>Delete</DropdownMenuItem>}\n            </DropdownMenuGroup>\n          </DropdownMenuContent>\n        </DropdownMenu>\n      ),\n    })\n  }\n\n  const table = useReactTable({\n    data,\n    columns,\n    getCoreRowModel: getCoreRowModel(),\n    getPaginationRowModel: getPaginationRowModel(),\n  })\n\n  const LoadMoreButton = () => {\n    if (!nextPageToken) return\n\n    const loadMore = () => onLoadMore && onLoadMore(nextPageToken)\n\n    return (\n      <div className=\"flex items-center justify-end space-x-2 py-4\">\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={loadMore}\n        >\n          Load More\n        </Button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex flex-col gap-2\">\n      <div className=\"rounded-md border\">\n        <Table>\n          <TableHeader>\n            {table.getHeaderGroups().map((headerGroup) => (\n              <TableRow key={headerGroup.id}>\n                {headerGroup.headers.map((header) => {\n                  return (\n                    <TableHead key={header.id}>\n                      {header.isPlaceholder\n                        ? null\n                        : flexRender(\n                          header.column.columnDef.header,\n                          header.getContext()\n                        )}\n                    </TableHead>\n                  )\n                })}\n              </TableRow>\n            ))}\n          </TableHeader>\n          <TableBody>\n            {table.getRowModel().rows?.length ? (\n              table.getRowModel().rows.map((row) => (\n                <TableRow\n                  key={row.id}\n                  data-state={row.getIsSelected() && \"selected\"}\n                >\n                  {row.getVisibleCells().map((cell) => (\n                    <TableCell key={cell.id}>\n                      {flexRender(cell.column.columnDef.cell, cell.getContext())}\n                    </TableCell>\n                  ))}\n                </TableRow>\n              ))\n            ) : (\n              <TableRow>\n                <TableCell colSpan={columns.length} className=\"h-24 text-center\">\n                  No results.\n                </TableCell>\n              </TableRow>\n            )}\n          </TableBody>\n        </Table>\n      </div>\n      <LoadMoreButton />\n    </div>\n  )\n}",
      "type": "registry:block",
      "target": "components/ui/crud/table.tsx"
    },
    {
      "path": "registry/new-york/blocks/crud/form.tsx",
      "content": "\"use client\"\n\ntype CrudFormProps = {\n  children: React.ReactNode\n} & React.HTMLAttributes<HTMLDivElement>\n\nconst CrudForm = ({ children, ...props }: CrudFormProps) => {\n  return (\n    <div {...props}>\n      {children}\n    </div>\n  )\n}\n\nexport default CrudForm\n",
      "type": "registry:block",
      "target": "components/ui/crud/form.tsx"
    }
  ]
}